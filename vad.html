<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Activity Detection (Final)</title>
    
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.0/dist/ort.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ricky0123/vad-web@0.0.9/dist/bundle.min.js"></script>
    
    <style>
        body { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: Arial, sans-serif; background-color: #f0f0f0; color: #333; margin: 0; }
        #status { font-size: 2em; padding: 20px; border: 2px solid #ccc; border-radius: 10px; background-color: #fff; min-width: 250px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        button { margin-top: 20px; padding: 10px 20px; font-size: 1em; cursor: pointer; border: none; border-radius: 5px; background-color: #007bff; color: white; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
    </style>
</head>
<body>

    <div id="status">等待啟動...</div>
    <button id="startButton">啟動麥克風</button>

    <script>
        const statusElement = document.getElementById('status');
        const startButton = document.getElementById('startButton');

        async function main() {
            startButton.addEventListener('click', async () => {
                try {
                    startButton.disabled = true;
                    startButton.textContent = '正在啟動...';

                    const myvad = await vad.MicVAD.new({
                        onSpeechStart: () => {
                            console.log("Speech started");
                            statusElement.textContent = '偵測到語音：開始講話';
                            statusElement.style.borderColor = '#28a745';
                        },
                        onSpeechEnd: (audio) => {
                            console.log("Speech ended");
                            statusElement.textContent = '語音結束：停止講話';
                            statusElement.style.borderColor = '#dc3545';
                        },
                    });
                    
                    myvad.start();
                    
                    statusElement.textContent = '正在監聽...';
                    statusElement.style.borderColor = '#007bff';
                    startButton.textContent = '監聽中';

                } catch (error) {
                    console.error("啟動 VAD 失敗:", error);
                    statusElement.textContent = '啟動失敗，請檢查權限或控制台錯誤';
                    startButton.disabled = false;
                    startButton.textContent = '重試';
                }
            });
        }
        main();
    </script>

</body>
</html>